theme_minimal()+
theme(
axis.text.x = element_text(angle=90),
legend.position = 'bottom',
strip.text.x = element_blank()
)
period_inf/period_cas
ggsave('plots/periods.png',width = 7, height=5, units='in')
period_all_bias = ggplot(rbind(period_scores_cas[,type:='cases'], period_scores_inf[,type:='infections'])[model != 'baseline_linex_lv',]) +
geom_path(aes(x=bias, y=crps_rel, color=model), alpha=0.6, linetype='dashed')+
geom_point(aes(x=bias, y=crps_rel, color=model, size=horizon), alpha=0.6)+
geom_hline(yintercept=1)+
geom_vline(xintercept=0)+
scale_y_continuous(trans='log2', name='CRPS')+
scale_x_discrete(labels=NULL, name='Bias')+
scale_size(breaks = c(0,7,14,21,28))+
scale_color_manual(labels=c('CoMix contact data',
'No contact data',
'No interaction',
'Polymod contact data',
'Exponential baseline',
'Fixed value baseline'),
name = 'Model', values = as.vector(vibrant(6)))+
scale_fill_manual(labels=c('CoMix contact data',
'No contact data',
'No interaction',
'Polymod contact data',
'Exponential baseline',
'Fixed value baseline'),
name = 'Model', values = as.vector(vibrant(6)))+
facet_grid(type~periods, scale='free')+
theme_minimal()+
theme(
axis.text.x = element_text(angle=90),
legend.position = 'bottom'
)
ggsave('plots/periods_bias.png',width = 7, height=5, units='in')
overall_scores = rbind(overall_scores_inf[, type:='Infections'], overall_scores_cas[, type:='Cases'])
overall_scores = merge(overall_scores, overall_scores[model=='baseline_expex_lv'], by = c('type', 'horizon'), suffixes = c('','_baseline'))
overall_scores[, crps_rel := crps / crps_baseline]
overall_sp =
ggplot(overall_scores) +
#geom_curve(aes(x=model, xend=model, y=1, yend=crps_rel+horizon*0.00001, size=exp(horizon/7)), alpha=0.3, curvature = 0.15)+
geom_path(aes(x=bias, y=crps_rel, color=model), alpha=0.7)+
geom_point(aes(x=bias, y=crps_rel, color=model, size=horizon), alpha=0.7)+
geom_hline(yintercept = 1, alpha=0.5)+
geom_vline(xintercept = 0, alpha=0.5)+
facet_wrap(~type)+
scale_color_manual(labels=c('CoMix contact data',
'No contact data',
'No interaction',
'Polymod contact data',
'Exponential baseline',
'Fixed value baseline'),
name = 'Model', values = as.vector(vibrant(6)), guide='none')+
scale_size(breaks = c(0,7,14,21,28))+
scale_y_continuous(trans='log2', name='crps')+
theme_minimal()+
ggtitle('A')+
theme(
axis.text.x = element_text(angle=90),
legend.position = 'bottom'
)
overageres = overall_sp / age_inf / age_cas + plot_layout(heights = c(2,1,1))
ggsave('plots/overall_results.pdf', plot = overageres, width = 7, height=7, units = 'in')
ggsave('plots/overall_results.png', plot = overageres, width = 7, height=7, units = 'in', dpi=300)
((preds_plot_inf + ggtitle('A'))     +  (scores_plot_inf + ggtitle('C')) + plot_layout(widths=c(4,1))) /
((preds_plot_cas + scale_y_continuous(trans = 'log10', limits = c(1e2, 1e6)) + ggtitle('B'))     +  (scores_plot_cas + ggtitle('D')) + plot_layout(widths=c(4,1))) /
guide_area()  + plot_layout(guides = 'collect', heights=c(3,3,1))
ggsave('plots/preds_scores_both.png', width=15, height=10, units='in')
inf_pars = readRDS('outputs/summary_pars_infweek.rds')
cas_pars = readRDS('outputs/summary_pars_cases.rds')
plot_parameters(inf_pars, dates, '_infections')
plot_parameters(cas_pars, dates, '_cases')
summary_pars
samples_preds
summary_pars
dcast(summary_pars, formula = index + forecast_date + run ~ name, value.var = `50%`)
dcast(summary_pars, formula = index + forecast_date + run ~ name, value.var = '50%')
dcast(summary_pars[,c('index','forecast_date', 'run', 'name', '50%')], formula = index + forecast_date + run ~ name, value.var = '50%')
dcast(unique(summary_pars[,c('index','forecast_date', 'run', 'name', '50%')]), formula = index + forecast_date + run ~ name, value.var = '50%')
dcast(unique(summary_pars[,c('index','forecast_date', 'run', 'name', '50%')]), formula = forecast_date + run ~ index + name, value.var = '50%')
dcast(unique(summary_pars[,c('index','forecast_date', 'run', 'name', '50%')]), formula = forecast_date + run + name ~ index , value.var = '50%')
dcast(unique(summary_pars, formula = forecast_date + run + name ~ index , value.var = '50%')
dcast(unique(summary_pars, formula = forecast_date + run + name ~ index , value.var = '50%'))
dcast(unique(summary_pars, formula = forecast_date + run + name ~ index , value.var = '50%'))
dcast(unique(summary_pars), formula = forecast_date + run + name ~ index , value.var = '50%')
dcast(unique(summary_pars[!is.na(index)]), formula = forecast_date + run + name ~ index , value.var = '50%')
pars_wide = dcast(unique(summary_pars[!is.na(index)]), formula = forecast_date + run + name ~ index , value.var = '50%')
pars_wide[, ad_rat := (`3`     +   `4`     +   `5`) / (`1` + `2`)  ]
summary_scores = score_forecasts(summary_preds[date > as.Date('2020-10-01') & !(run %in% c(2,3))],
pandemic_periods,
age_groups = age_groups,
suffix = '_infections',
labels = c('Full contact model',
'No contact data',
'Polymod data',
'No interaction',
'Exponential baseline',
'Fixed value baseline',
'Linear baseline'))
pars_wide
pars_wide[, el_rat := (`6`     +   `7`     +   `8`) / (`1` + `2`)  ]
pars_wide
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date))+
facet_wrap(~run)
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date))+
facet_grid(name~run)
pars_wide[, el_rat := (`6`     +   `7`     +   `8`)*2 / (`1` + `2`) /3 ]
pars_wide[, ad_rat := (`3`     +   `4`     +   `5`)*2 / (`1` + `2`)/3  ]
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date))+
facet_grid(name~run)
inf_pars_wide = dcast(unique(inf_pars[!is.na(index)]), formula = forecast_date + run + name ~ index , value.var = '50%')
case_pars_wide = dcast(unique(inf_pars[!is.na(index)]), formula = forecast_date + run + name ~ index , value.var = '50%')
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date))+
scale_color_viridis()+
facet_grid(name~run)
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date))+
scale_color_viridis()+
facet_grid(name~run, scale='free')
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date))+
scale_color_viridis()+
vline(xintercept=1)+
hline(yintercept=1)+
facet_grid(name~run, scale='free')
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date))+
scale_color_viridis()+
geom_vline(xintercept=1)+
geom_hline(yintercept=1)+
facet_grid(name~run, scale='free')
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date))+
scale_color_viridis()+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free')+
theme_minimal()
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date))+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2')+
scale_x_continuous(trans='log2')+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free')+
theme_minimal()
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date))+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s')+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s')+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free')+
theme_minimal()
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=2)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s')+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s')+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=))+
theme_minimal()
model_labs = c('CoMix', 'No data', 'No interaction', 'POLYMOD')
names(model_labs) = c(1,4,5,6)
model_labs = c('CoMix', 'No data', 'No interaction', 'POLYMOD')
names(model_labs) = c(1,4,5,6)
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=2)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s')+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s')+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs))+
theme_minimal()
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1.2)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s')+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s')+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs))+
theme_minimal()
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s')+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s')+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs))+
theme_minimal()
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/2.5, 2.5))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/2.5, 2.5))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs))+
theme_minimal()
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs))+
theme_minimal()
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/4, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs))+
theme_minimal()
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.5, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs))+
theme_minimal()
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs))+
theme_minimal()
par_labs = c('Infectiousness', 'Susceptibility')
names(par_labs) = c('Inf_rate', 'susceptibility')
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
names(par_labs) = c('inf_rate', 'susceptibility')
ggplot(pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
inf_pars_wide[, ad_rat := (`3`     +   `4`     +   `5`)*2 / (`1` + `2`)/3  ]
inf_pars_wide[, el_rat := (`6`     +   `7`     +   `8`)*2 / (`1` + `2`) /3 ]
cas_pars_wide[, ad_rat := (`3`     +   `4`     +   `5`)*2 / (`1` + `2`)/3  ]
cas_pars_wide[, el_rat := (`6`     +   `7`     +   `8`)*2 / (`1` + `2`) /3 ]
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
inf_pars_wide[, ad_rat := (`3`     +   `4`     +   `5`)*2 / (`1` + `2`)/3  ]
inf_pars_wide[, el_rat := (`6`     +   `7`     +   `8`)*2 / (`1` + `2`) /3 ]
inf_pars_wide[, ad_rat := (`3`     +   `4`     +   `5`)*2 / (`1` + `2`)/3  ]
inf_pars_wide[, el_rat := (`6`     +   `7`  ) / (`1` + `2`) ]
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
ggplot(cas_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
ggplot(cas_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
cas_pars_wide[, ad_rat := (`3`     +   `4`     +   `5`)*2 / (`1` + `2`)/3  ]
cas_pars_wide[, el_rat := (`6`     +   `7`     +   `8`)*2 / (`1` + `2`) /3 ]
ggplot(cas_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
cas_pars_wide = dcast(unique(inf_pars[!is.na(index)]), formula = forecast_date + run + name ~ index , value.var = '50%')
cas_pars_wide[, ad_rat := (`3`     +   `4`     +   `5`)*2 / (`1` + `2`)/3  ]
cas_pars_wide[, el_rat := (`6`     +   `7`     +   `8`)*2 / (`1` + `2`) /3 ]
ggplot(cas_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
cas_pars_wide[, ad_rat := (`3`     +   `4`     +   `5`)*2 / (`1` + `2`)/3  ]
cas_pars_wide[, el_rat := (`6`     +   `7`     +   `8`)*2 / (`1` + `2`) /3 ]
cas_pars_wide = dcast(unique(cas_pars[!is.na(index)]), formula = forecast_date + run + name ~ index , value.var = '50%')
cas_pars_wide[, ad_rat := (`3`     +   `4`     +   `5`)*2 / (`1` + `2`)/3  ]
cas_pars_wide[, el_rat := (`6`     +   `7`     +   `8`)*2 / (`1` + `2`) /3 ]
ggplot(cas_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
new_scale_color()+
geom_path(data=cas_pars_wide, aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis_c(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
install.packages('ggnewscale')
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
new_scale_color()+
geom_path(data=cas_pars_wide, aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis_c(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
library(ggnewscale)
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
new_scale_color()+
geom_path(data=cas_pars_wide, aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis_c(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
new_scale_color()+
geom_path(data=cas_pars_wide, aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis_b(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates)+
new_scale_color()+
geom_path(data=cas_pars_wide, aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates, option="magma")+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates, name='Infections')+
new_scale_color()+
geom_path(data=cas_pars_wide, aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates, option="magma", name='Cases')+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(breaks = as.numeric(lab_dates),
labels = lab_dates, name='Infections')+
new_scale_color()+
geom_path(data=cas_pars_wide, aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(name='',breaks = as.numeric(lab_dates),
labels = lab_dates, option="magma", name='Cases')+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(breaks = as.numeric(lab_dates),
labels = lab_dates, name='Infections')+
new_scale_color()+
geom_path(data=cas_pars_wide, aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(breaks = as.numeric(lab_dates),
labels = lab_dates, option="magma", name='Cases')+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.25, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
ggplot(inf_pars_wide) +
geom_path(aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(breaks = as.numeric(lab_dates),
labels = lab_dates, name='Infections')+
new_scale_color()+
geom_path(data=cas_pars_wide, aes(x=ad_rat, y=el_rat, color=forecast_date), size=1)+
scale_color_viridis(breaks = as.numeric(lab_dates),
labels = lab_dates, option="magma", name='Cases')+
scale_y_continuous(trans='log2', name='50+ relative to under 15s', limits=c(1/3.5, 3))+
scale_x_continuous(trans='log2', name='16-49s relative to under 15s', limits=c(1/3, 3))+
geom_vline(xintercept=1, alpha=0.2)+
geom_hline(yintercept=1, alpha=0.2)+
facet_grid(name~run, scale='free', labeller=labeller(run=model_labs, name=par_labs))+
theme_minimal()
source("~/Documents/WORK/Analyses/CISA/CovidAgeGroupForecast/R/fit_model_cases.R")
rstan:::rstudio_stanc("stan/multi-option-contact-model-cases.stan")
rstan:::rstudio_stanc("stan/multi-option-contact-model-cases.stan")
source("~/Documents/WORK/Analyses/CISA/CovidAgeGroupForecast/R/plotting.R")
source("~/Documents/WORK/Analyses/CISA/CovidAgeGroupForecast/R/score_forecasts_samples.R")
